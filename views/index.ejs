<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messenger</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-3-typeahead/4.0.1/bootstrap3-typeahead.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="assets/css/index.css">
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script src="assets/src/search.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script defer src="assets/src/send.js"></script>
    <script>
        const checkFriend = (idSender, idReceiver) => {
            $.ajax({
                url: "/checkFriend",
                type: "POST",
                data: {
                    idSender: idSender,
                    idReceiver: idReceiver
                },
                success: (result) => {
                    $.each(result, function(key, val) {
                        if (val.status == "1") {
                            $('.friend' + idReceiver).html('<i class="fas fa-check"></i><span> Bạn bè</span>')
                        } else if (val.status == "0") {
                            if (val.idSender == idSender) {
                                $('.friend' + idReceiver).html('<i class="fas fa-user-times"></i><span> Đã gửi lời mời</span>')
                            } else if (val.idReceiver == idSender) {
                                $('.friend' + idReceiver).html('Xác Nhận')
                                $('.huy' + idReceiver).html('Hủy')

                            }
                        }
                    })
                }
            })
        }

        const buttonFriend = (id) => {
            var idUser = "<%= idUser%>";
            $.ajax({
                url: "/friend",
                type: "POST",
                data: {
                    userId: idUser
                },
                success: function(result) {
                    $.each(result, function(key, val) {
                        var friends = val.friend.split(',')
                        if (friends.includes(id + "")) {
                            checkFriend(idUser, id)
                        } else {
                            $('.friend' + id).html('<i class="fas fa-user-plus"></i><span> Thêm bạn bè</span>')
                        }
                    })
                }
            });
        }
    </script>
</head>

<body>
    <div class="container-fuild">
        <div class="container-top">
            <% if(message.length > 0 ){ %>
                <div class="notification">
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <h4 class="alert-heading">Thông báo!</h4>
                        <strong>Xin chào!</strong>
                        <%= message %>
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    </div>
                </div>
                <% } %>
                    <div class="user">
                        <div class="user-container hover">
                            <div class="hover user-image"></div>
                            <div class="user-name">
                                <% if(user){%>
                                    <%= user %>
                                        <% }%>
                            </div>
                        </div>
                        <div class="user-more icon hover">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="user-notification icon hover">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="user-sigup icon hover">
                            <i class="fas fa-caret-down"></i>
                        </div>
                    </div>
        </div>
        <div class="container-left">
            <div class="container-listChat">
                <div class="title">
                    <div>Chat</div>
                    <div class="icon">
                        <div>
                            <i class="fas fa-cog"></i>
                        </div>
                    </div>
                </div>
                <div id="focus">
                    <div class="search">
                        <i class="fas fa-search"></i>
                        <input maxlength="20" class="searchName" name="searchName" type="text" id="searchName" value="" placeholder="Tìm kiếm trên Messenger">
                    </div>
                    <div id="suggesstion-box" style="display: block;" class="suggesstion-box">
                        <div id="text"></div>
                        <div id="list-suggesstion"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-right">
            <div class="top-r">
                <div class="name-receiver" style="color: white;">
                    <div class="row">
                        <div class="col-md-10"></div>
                        <div class="col-md-2"></div>
                    </div>
                </div>
                <div class="chat">
                    <div class="content-chat">
                        <div class="content">
                            <div class="sender"></div>
                            <div class="receiver"></div>
                        </div>
                        <div class="content-send">
                            <div class="row">
                                <div class="col-md-1"><i class="fas fa-plus"></i></div>
                                <div class="col-md-1"><i class="far fa-smile-wink"></i></div>
                                <div class="col-md-1"><i class="fas fa-image"></i></div>
                                <div class="col-md-8"><input class="message" name="message" id="message" placeholder="Nhập nội dung của bản" type="text"></div>
                                <div class="col-md-1"><button class="send">send</button></div>
                            </div>
                        </div>
                    </div>
                    <div class="setting-chat"></div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>